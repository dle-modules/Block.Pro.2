<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    
<title>Документация к модулю Block.Pro.2 для DLE</title>  

<style type="text/css">  
	html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent;}
	table{border-collapse:collapse;border-spacing:0;}
	html{height:100%;}
	::-moz-selection{background:#65a7bc;color:#fff;text-shadow:none;}
	::selection{background:#65a7bc;color:#fff;text-shadow:none;}
	body{font:16px/22px "Trebuchet MS",Arial,Helvetica,sans-serif;background:#e7e5da;text-shadow:1px 1px 0 #f7f6f2;color:#413333;width:100%;height:100%;}
	a{color:#fc6341;outline:none;text-decoration:underline;}
	a:hover{color:#65a7bc;text-decoration:none;}
	p{margin:0 0 18px;}
	h1,h2,h3,h4{font:normal 30px "Trebuchet MS",Arial,Helvetica,sans-serif;color:#413333;text-transform:uppercase;margin:1em 0;}
	h2{color:#65a7bc;font-size:22px;text-decoration:none;border-bottom:solid 3px #cfcec4;}
	h3,.news.full h2{color:#fc6341;font-size:18px;}
	h4{font-size:20px;text-transform:none;}
	.main{width:960px;margin:10px auto;}
	strong{color:#65a7bc;}
	.content-table{margin:20px auto;width:100%;}
	.content-table th,.content-table td{padding:4px 5px;line-height:18px;text-align:left;vertical-align:top;border-top:1px solid #CFCEC4;}
	.content-table tr:hover{background:#dedbcb;}
	.row1,.row2,.row3,.row4{vertical-align:middle;text-align:center;font-weight:bold;background:#cfcec4;border:none;}
	.content-table th[scope="row"],.content-table td[scope="row"]{font-family:"Courier New",Courier,monospace;}
	.row1{font-family:"Trebuchet MS",Arial,Helvetica,sans-serif !important;}
	.ib{display:inline-block;width:150px;}
	.liststyle{list-style:circle inside;margin:10px 0 20px;}
	ol{list-style-position:inside;}
	li{margin:0 0 10px;}
	pre{padding:10px;background:#fffff0;}
	.last{padding-bottom:50px;}
	.new {color:#FF0000}
</style>
</head>

<body>  
<section>
<div class="main">
	<h1>Документация к модулю Block.Pro.2 для DLE</h1>    
	<p><strong>Block.Pro.2 - Расширенный вывод блоков с новостями для DLE</strong></p> 
	<p>Модуль для удобного и гибкого вывода новостей а любой странице DLE-сайта</p>
	<p><span class="ib">Версия DLE:</span> <b>9.5</b>+ <i>(на более старых версиях не проверялся, но работать должен)</i></p>  
	<p><span class="ib">Версия модуля:</span> <b>2.6.4</b></p>
	<p><span class="ib">Дата релиза:</span> <b>22.06.2012</b></p>	
	<p><span class="ib">Автор:</span> <b>ПафНутиЙ</b></p>
	<p><span class="ib">Контакты:</span> <b><a href="http://pafnuty.name" title="ПафНутиЙ-Блог" target="_blank">http://pafnuty.name</a>, <a href="http://gplus.to/pafnuty" title="Google+" target="_blank">Google+</a> или <a href="mailto:pafnuty10@gmail.com">email</a></b> </p>  
	<h3>Модуль распространяется бесплатно для частного и коммерческого использования</h3> 
	<h3>При публикации модуля на других сайтах не забывайте оставлять ссылку на первоисточник, уважайте чужой труд.</h3>
	<h2>Основные возможности модуля</h2>  
	<ul class="liststyle">
		<li>Вывод популярных (топ по комментариям, рейтингу, просмотрам или как стандартный топ в dle), похожих, случайных (с возможностью отключения кеширования блока) или последних новостей.</li>
		<li>Подключение модуля одной строкой непосредственно любой в шаблон (через include).</li>
		<li>Простая и очень гибкая настройка вывода каждого блока.</li>
		<li>Кеширование каждого блока (обновление кеша при добавлении новости или комментария на сайт) с возможностью отключения кеша для каждого блока.</li>
		<li>Настройка категорий для вывода новостей (вывод только из определённых категорий, игнорирование определённых категорий, вывод или ингорирование новостей из просматриваемой категории)</li>
		<li>Вывод уменьшенной копии картинки (в т.ч. и вместе с оригинальной картинкой) из короткой новости или дополнительного поля (картинки берутся только из папки uploads текущего сайта).</li>
		<li>Автоматическое создание папки для уменьшенных копий изображений и выставление нужных прав.</li>
		<li>Обрезка заголовка новости до заданного количества символов.</li>
		<li>Обрезка текста новости (до заданного количества символов или до конца слова).</li>
		<li>Ввод иконок категории.</li>
		<li>Можно задать временной интервал для отбора новостей (по умолчанию 30дней).</li>
		<li>Можно задать каждому блоку свой шаблон, свою картинку-заглушку.</li>
		<li>Поддержка всех тегов, используемых в шаблонах кратких новостей.</li>
		<li>Возможность быстрого редактирования новостей прямо из блока.</li>
		<li>Поддержка фильтра (перекрестные ссылки) по допполям, реализованного в DLE9.5</li>
		<li>Можно указать с какой по счету новости начать вывод (например с 4й по 15ю).</li>
		<li>Возможность быстрого редактирования новостей прямо из блока, аналогично стандартному функционалу.</li>
		<li>Фильтрация новостей по имени автора.</li>
		<li>Фильтрация новостей по дополнительным полям (проверяется только заполненность поля).</li>
		<li><span class="new">new</span> Фильтрация новостей по ID (работает по аналогии с фильтрацией по категориям)</li>
		<li><span class="new">new</span> Возможность задать &quot;Время жизни&quot; для кеша каждого блока.</li>
	</ul> 
	<h2>Установка модуля</h2>   
	<ol>
		<li>Скопировать файл <strong>block.pro.2.php</strong> в папку <strong>engine/modules/</strong></li>
		<li>Скопировать содержимое папки <strong>THEME</strong> в папку с текущим шаблоном сайта</li>
		<li>В нужном месте прописать строку подключения модуля с обязательными параметрами: <br /><strong>{include file="engine/modules/block.pro.2.php?&amp;block_id=BLOCK&amp;template=blockpro"}</strong> <br /><i>Где:<br /> <strong>BLOCK</strong> - Уникальный идентификатор блока<br /><strong>blockpro</strong> - имя шаблона, используемого для вывода</i></li> 
		<li>Настроить дополнительные параметры строки подключения и шаблон</li>
	</ol>    
	<h4>Для вывода похожих новостей</h4> 
	<ol>
		<li>Отключить стандартный вывод похожих новостей в админке <i>(Настройка системы &raquo; Оптимизация запросов к базе данных &raquo; Отображение похожих новостей &raquo; "нет")</i></li>
		<li>Открыть файл <strong>engine/modules/show.full.php</strong> <br /> перед
		<pre><code>		if( $config['related_news']</code></pre>    
		вставить 
		<pre><code>/*Block.Pro - relatednews*/
$block_id = 'related_'.$row['id']; //Не трогать!
$relatedpro = "1"; //Не трогать!
$template="relatednews"; // Имя шаблона (можно менять)
include_once ENGINE_DIR . '/modules/block.pro.2.php';		
/*Block.Pro - relatednews*/</code></pre></li> 
		<li>Настроить дополнительные переменные подключения модуля (<i>Переменные приведены в таблице ниже. При вставке необходимо заменять символ <strong>&</strong> на <strong>$</strong></i>) и шаблон</li>
	</ol> 
	      
	<h2>Переменные строки подключения</h2>
	<p>Все переменные указываются непосредственно в строке подключения модуля.</p>    
	<p>В таблице дано описание возможных для использования переменных</p>	
	
	<table class="content-table">
  	<tr>
    	<th class="row1" scope="row">Наименование переменной</th>
    	<td class="row2">Значение по умолчанию</td>
    	<td class="row3">Описание</td>
    	<td class="row4">Примечание</td>
  	</tr>
  	<tr>
    	<th scope="row">&amp;block_id</th>
    	<td>&nbsp;</td>
    	<td>Обязательная переменная. Уникальный идентификатор блока </td>
    	<td>любое, уникальное для каждого блока значение</td>
  	</tr>
  	<tr>
    	<th scope="row">&amp;template</th>
    	<td>&nbsp;</td>
    	<td>Обязательная переменная. Имя шаблона для вывода блока</td>
    	<td>указывается только имя, без расширения .tpl</td>
  	</tr>
  	<tr>
    	<th scope="row">&amp;day</th>
    	<td>30</td>
    	<td>Количество дней, за которое осуществляется отбор новостей.  Если указать ноль (0) - будут браться новости за всё время.</td>
    	<td>Переменная автоматически принимает нулевое значение, если в строке подключения определена переменная &amp;last, &amp;relatedpro или &amp;rndom</td>
  	</tr>
  	<tr>
    	<th scope="row">&amp;show_cat</th>
    	<td>&nbsp;</td>
    	<td>Категория/категории для отбора новостей.</td>
    	<td><p>Категории указываются через запятую.</p>
    	<p>Если указать &amp;show_cat=this - новости будут браться только из просматриваемой категории.</p></td>
  	</tr>
  	<tr>
    	<th scope="row">&amp;ignore_cat</th>
    	<td>&nbsp;</td>
    	<td>Модификатор переменной &amp;show_cat. превращает указанные в &amp;show_cat категории в игнорируемые.</td>
    	<td>Для активации модификатора достаточно его определить (например &amp;ignore_cat=y)</td>
  	</tr>
  	<tr>
  	  <th scope="row">&amp;post_id</th>
  	  <td>&nbsp;</td>
  	  <td><span class="new">new</span>&nbsp;Фильтрация новостей по их ID</td>
  	  <td><p>ID новостей указываются через запятую.</p>
  	    <p>Если в строке подключения указать &amp;post_id=<span class="new">this</span>&amp;ignore_post_id=y Будут отбираться все новости, кроме той новости, в которой находится пользователь. </p>
  	    <p><s><span class="new">Важно!</span> &amp;post_id={news-id} - работает только в fullstory.tpl и shortstory.tpl</s> <span class="new">Работает в любом месте</span></p></td>
	  </tr>
  	<tr>
  	  <th scope="row">&amp;ignore_post_id</th>
  	  <td>&nbsp;</td>
  	  <td><span class="new">new</span>&nbsp;Модификатор переменной &amp;post_id. Превращает ID, указанные в &amp;post_id в игнорируемые.</td>
  	  <td>Для активации модификатора достаточно его определить (например &amp;ignore_post_id=y). Пример использования указан строкой выше.</td>
	  </tr>
  	<tr>
    	<th scope="row">&amp;start_from</th>
    	<td>0</td>
    	<td>Начало диапазона отбора новостей.</td>
    	<td>&nbsp;</td>
  	</tr>
  	<tr>
    	<th scope="row">&amp;news_num</th>
    	<td>10</td>
    	<td>Количество новостей в блоке</td>
    	<td>&nbsp;</td>
  	</tr>
  	<tr>
    	<th scope="row">&amp;img_xfield</th>
    	<td>&nbsp;</td>
    	<td>Имя дополнительного поля для получения уменьшенного изображения. </td>
    	<td><p>Переменную нужно определять только тогда, когда требуется выводить картинку из дополнительного поля. </p>
    	<p>Одновременный вывод картинки из краткого содержимого и допполя невозможен.</p>
    	<p>В допполе должна лежать прямая ссылка а изображение.</p></td>
  	</tr>
  	<tr>
    	<th scope="row">&amp;img_size</th>
    	<td>60x60</td>
    	<td>Размер уменьшенной копии изображения. (Ширина X Высота)</td>
    	<td>Допустимо указывать одну цифру (например 100). тогда изображение будет уменьшено по большей стороне. при указании нуля (&amp;img_size=0) изображение обрезаться не будет.</td>
  	</tr>
  	<tr>
    	<th scope="row">&amp;noimage</th>
    	<td>noimage.png</td>
    	<td>Имя и расширение для картинки-заглушки, в случаи отсутствия изображения в новости.</td>
    	<td>Картинка-заглушка должна располагаться в папке images текущего  шаблона сайта.</td>
  	</tr>
  	<tr>
    	<th scope="row">&amp;nocache</th>
    	<td>&nbsp;</td>
    	<td>Модификатор, отключающий использование кеша для блока.</td>
    	<td>Для активации модификатора достаточно его определить (например &amp;nocache=y)</td>
  	</tr>
  	<tr>
  	  <th scope="row">&amp;cache_live</th>
  	  <td>&nbsp;</td>
  	  <td><p>Переменная, задающая время жизни кеша блока.</p>
  	    <p>Указывается в секудах.</p></td>
  	  <td><p>Например если нужно, чтобы блок обновлялся каждые сутки: &amp;cache_live=86400</p>
  	    <p>При формировании блока модуль проверяет время жизни кеша блока и если оно превышает или равно указанному в переменной - создаёт новый файл кеша.</p></td>
	  </tr>
  	<tr>
    	<th scope="row"><p>&nbsp;</p>
      	<p>&amp;random</p>
    	<p>&amp;last</p>
    	<p>&amp;top_comm</p>
    	<p>&amp;top_rating</p>
    	<p>&amp;top_views</p></th>
    	<td>&nbsp;</td>
    	<td><p>Варианты сортировки новостей.</p>
    	<p>Случайным образом</p>
    	<p> По дате добавления</p>
    	<p>Самые комментируемые</p>
    	<p>Самые рейтинговые</p>
    	<p>Самые часто просматриваемые</p></td>
    	<td><p>По умолчанию выводятся топ-новости (по аналогии со стандартным топом DLE)</p>
    	<p>Недопустимо использование нескольких вариантов сортировки одновременно.</p></td>
  	</tr>
  	<tr>
    	<th scope="row">&amp;wordcut</th>
    	<td>&nbsp;</td>
    	<td>Модификатор, отключающий обрезку текста новости до конца слова и включающий обрезку до заданного количества символов.</td>
    	<td>Для активации модификатора достаточно его определить (например &amp;wordcut=y)</td>
  	</tr>
  	<tr>
  	  <th scope="row">&amp;author</th>
  	  <td>&nbsp;</td>
  	  <td>Фильтрация новостей по имени автора</td>
  	  <td><p>Указать в строке подключения переменную &amp;author={usertitle} для вывода новостей автора на странице его профиля. Так же {usertitle} можно заменить на имя автора.</p>
  	    <p> <span class="new">Важно!</span> тег {usertitle} будет работать только при вставке строки подключения в шаблон userinfo.tpl</p></td>
	  </tr>
  	<tr>
  	  <th scope="row">&amp;xfilter</th>
  	  <td>&nbsp;</td>
  	  <td>Фильтрация новостей по дополнительным полям</td>
  	  <td>В фильтр попадают только новости, у которых заполнено указанное дополнительное поле (в строке подключения нужно указать переменную &amp;xfilter=image, text - в этом случаи будут отобранны только те новости, в которых заполненны допполя image и text)</td>
	  </tr>
  	<tr>
    	<th scope="row">$relatedpro</th>
    	<td>&nbsp;</td>
    	<td>Модификатор активирует механизм отображения похожих новостей. Указывается только при подключении модуля в файле show.full.php для вывода похожих новостей.</td>
    	<td>Для активации модификатора достаточно его определить (например $relatedpro=y;)</td>
  	</tr>
  	<tr>
  	  <th scope="row">&amp;showstat</th>
  	  <td>&nbsp;</td>
  	  <td>Модификатор активирует показ времени генерации блока для пользователя с ID=1 (Администратор)</td>
  	  <td>Для активации модификатора достаточно его определить (например $showstat=y;)</td>
	  </tr>
	</table>  

	
	<h2>Теги шаблона</h2>   
	<p>В таблице приведены возможные для использования в шаблоне теги и их описание.</p>
	<table class="content-table">
  		<tr>
    		<th class="row1" scope="row">Обозначение тега шаблона</th>
    		<td class="row2">Описание</td>
    		<td class="row3">Примечание</td>
  		</tr>
  		<tr>
    		<th scope="row">{link-category}</th>
    		<td>Ссылка/ссылки на категории</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{category}</th>
    		<td>Наименование категории</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{category-icon}</th>
    		<td>Иконка/иконки категорий</td>
    		<td>При отсутствии иконки берётся картинка {THEME}/images/no_icon.gif</td>
  		</tr>
  		<tr>
  		  <th scope="row">{category-url}</th>
  		  <td>Ссылка на категорию в чистом виде</td>
  		  <td>&nbsp;</td>
	  </tr>
  		<tr>
    		<th scope="row">[xfvalue_name]</th>
    		<td>Значение дополнительного поля &quot;name&quot;, где &quot;name&quot; название дополнительного поля</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">[xfgiven_name] [xfvalue_name] [/xfgiven_name]</th>
    		<td>Выводится дополнительное поле &quot;name&quot;, если поле не пустое, если поле не имеет значения, то текст просто вырезается</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">[xfnotgiven_name] текст [/xfnotgiven_name]</th>
    		<td>Выводят текст указанный в тегах, если дополнительное поле не было задано при публикации новости, где &quot;name&quot; это имя дополнительного поля</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{image-X}</th>
    		<td>Выводит URL уменьшенной картинки находящейся в краткой новости, где Х это номер картинки в новости, например {image-1} выведет URL первой картинки в краткой новости</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{image_original}</th>
    		<td>Выводит URL оригинальной картинки, указанной в {image-X}</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">[image_original] текст [/image_original]</th>
    		<td>Выводят текст указанный в тегах, если есть {image_original}</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">[not_image_original] текст [/not_image_original]</th>
    		<td>Выводят текст указанный в тегах, если нет {image_original}</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{rating}</th>
    		<td>Выводит рейтинг</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{vote-num}</th>
    		<td>Выводит количество проголосовавших</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">[profile] текст [/profile]</th>
    		<td>Выводят прямую ссылку на профиль автора публикации, без использования всплывающего окна минипрофиля.</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{login}</th>
    		<td>Выводит логин пользователя добавившего новость в виде обычной текстовой информации без ссылок на профиль и карточку пользователя.</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{author}</th>
    		<td>Ссылка на автора новости</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{date}</th>
    		<td>Дата новости в формате, установленном в настройках движка</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{date=X}</th>
    		<td>Дата новости в пользовательском формате</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{title}</th>
    		<td>Заголовок новости</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{title limit=&quot;X&quot;}</th>
    		<td>Заголовок новости, обрезанный до X символов.</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{text}</th>
    		<td>Текст новости (аналог {short-story})</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{text limit=&quot;X&quot;}</th>
    		<td>Текст новости, обрезанный до указанного X количества символов, при этом обрезание текста происходит до последнего логического слова, а не обрывает текст на середине слова.</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{full-link}</th>
    		<td>URL полной новости</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{comments-num}</th>
    		<td>Количество комментариев к новости</td>
    		<td>&nbsp;</td>
  		</tr>
  		<tr>
    		<th scope="row">{views}</th>
    		<td>Количество просмотров новости</td>
    		<td>&nbsp;</td>
  		</tr>
  		<!--<tr>
    		<th scope="row">[edit] текст [/edit]</th>
    		<td>Ссылка на редактирование новости</td>
    		<td>&nbsp;</td>
  		</tr>-->
	</table>    
		
		<h3>Техническая поддержка модуля осуществляется <strong>только</strong> по указанным контактным данным</h3>
		<p class="last">Но это не означает, что техподдержка будет оказана :)</p>
		
</div>
</section>
</body>
</html>
